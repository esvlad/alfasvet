{{ header }}
<div id="vakancy" class="container">
  <ul class="breadcrumb">
    {% for breadcrumb in breadcrumbs %}
    <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
    {% endfor %}
  </ul>
  <h2>Вакансии</h2>
  <div class="rowmin vakancy">
    {% if vakancyes %}
    {% for vakancy in vakancyes %}
    <div class="col-md-4 col-sm-6 col-xs-12">
      <div class="vakancy_block" data-vakancy="{{vakancy.id}}">
        <div class="vakancy_title"><span>{{vakancy.title}}</span>&nbsp;</div>
        <div class="vakancy_description">{{vakancy.description}}</div>
        <div class="vakancy_more"><span>Подробнее</span></div>
        <div class="btn_black" data-toggle="modal" data-target="#vakancyModal">Откликнуться</div>
      </div>
    </div>
    {% endfor %}
    {% endif %}
  </div>
  <div class="rowmin">
    <div class="col-lg-7 col-md-8 col-sm-12">
      <form id="vakancy-form-not" class="form-horizontal form-vakancy" name="vakacy_not">
        <div class="form_block">
          <div class="form_title clearfix">
            <img src="catalog/view/theme/default/img/svg/pen.svg" alt="">
            <h3>Заполните анкету</h3>
            <p>если нет подходящей вакансии</p>
          </div>
          <div class="rowmin">
            <div class="col-sm-6 col-xs-12">
              <div class="form-group required">
                <div class="col-sm-12">
                  <label for="" class="control-label">Имя*</label>
                  <input type="text" id="vakancy-name0" class="form-control" name="name" value="">
                </div>
              </div>
              <div class="form-group required">
                <div class="col-sm-12">
                  <label for="" class="control-label">Телефон*</label>
                  <input type="tel" id="vakancy-phone0" class="form-control" name="phone" value="">
                </div>
              </div>
              <div class="form-group required">
                <div class="col-sm-12">
                  <label for="" class="control-label">E-mail*</label>
                  <input type="email" id="vakancy-mail0" class="form-control" name="email" value="">
                </div>
              </div>
            </div>
            <div class="col-sm-6 col-xs-12">
              <div class="form-group required">
                <div class="col-sm-12">
                  <label for="" class="control-label">Должность*</label>
                  <input type="text" id="vakancy-dol0" class="form-control" name="vak_name" value="">
                </div>
              </div>
              <div class="form-group required">
                <div class="col-sm-12">
                  <label for="" class="control-label">Город*</label>
                  <input type="text" id="vakancy-city0" class="form-control" name="city" value="">
                </div>
              </div>
            </div>
          </div>
          <div class="rowmin">
            <div class="col-md-9 col-sm-8 col-xs-12">
              <div class="form-group">
                <div class="col-sm-12">
                  <label for="" class="control-label">Ссылка на резюме или файл</label>
                  <input type="text" id="vakancy-rezulr0" class="form-control" name="rezume_link" value="">
                </div>
              </div>
            </div>
            <div class="col-md-3 col-sm-4 col-xs-12">
              <div class="form-group">
                <div class="col-sm-12">
                  <label for="input-rezume0" class="control-label">&nbsp;</label>
                  <div class="input_file">
                    <div id="fountainG" class="loading">
                      <div id="fountainG_1" class="fountainG"></div>
                      <div id="fountainG_2" class="fountainG"></div>
                      <div id="fountainG_3" class="fountainG"></div>
                      <div id="fountainG_4" class="fountainG"></div>
                      <div id="fountainG_5" class="fountainG"></div>
                      <div id="fountainG_6" class="fountainG"></div>
                      <div id="fountainG_7" class="fountainG"></div>
                      <div id="fountainG_8" class="fountainG"></div>
                    </div>
                    <span>Выбрать</span>
                  </div>
                  <input type="hidden" name="rezume_code" value="" id="input-rezume0" />
                </div>
              </div>
            </div>
            <div class="col-sm-12">
              <div class="form-group required">
                <div class="col-sm-12">
                  <label for="" class="control-label">Расскажите о себе*</label>
                  <textarea name="text" id="vakancy-text0" rows="6" class="form-control" row="4" type="text" value=""></textarea>
                </div>
              </div>
            </div>
          </div>
          <div class="rowmin">
            <div class="col-sm-6 col-xs-12">
              <div id="vakansy0" class="btn_gold" data-vakancy="0"><span>Отправить</span></div>
            </div>
            <div class="col-lg-5 col-sm-6 col-xs-12">
              <p class="politics">Нажимая на кнопку, вы соглашаетесь с условиями <a href="{{politics}}" target="_blank">политики конфиденциальности и обработки персональных данных</a></p>
            </div>
          </div>
        </div>
        <div class="form_success"><span>Спасибо, ваше резюме отправлено!</span></div>
      </form>
    </div>
  </div>
</div>
<div class="modal fade" id="vakancyModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog _vakancy">
    <div class="modal-content">
      <p class="close" data-dismiss="modal" aria-hidden="true"></p>
        <div class="container-big-modal">
          <div class="modal_vakancy_block clearfix">
            <form id="vakancy-form" class="form-horizontal form-vakancy" name="vakancy_modal">
              <div class="form_block">
                <input type="hidden" name="vakancy_id" value="">
                <input type="hidden" name="vak_name" value="">
                <div class="form_title clearfix">
                  <img src="catalog/view/theme/default/img/svg/pen.svg" alt="">
                  <h3>Заполните анкету</h3>
                  <p>для вакансии <span class="vakancy_name"></span></p>
                </div>
                <div class="rowmin">
                  <div class="col-sm-6 col-xs-12">
                    <div class="form-group required">
                      <div class="col-sm-12">
                        <label for="" class="control-label">Имя*</label>
                        <input type="text" id="vakancy-name" class="form-control" name="name" value="">
                      </div>
                    </div>
                    <div class="form-group required">
                      <div class="col-sm-12">
                        <label for="" class="control-label">Телефон*</label>
                        <input type="tel" id="vakancy-phone" class="form-control" name="phone" value="">
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-6 col-xs-12">
                    <div class="form-group required">
                      <div class="col-sm-12">
                        <label for="" class="control-label">E-mail*</label>
                        <input type="email" id="vakancy-mail" class="form-control" name="email" value="">
                      </div>
                    </div>
                    <div class="form-group required">
                      <div class="col-sm-12">
                        <label for="" class="control-label">Город*</label>
                        <input type="text" id="vakancy-city" class="form-control" name="city" value="">
                      </div>
                    </div>
                  </div>
                </div>
                <div class="rowmin">
                  <div class="col-md-9 col-sm-8 col-xs-12">
                    <div class="form-group">
                      <div class="col-sm-12">
                        <label for="" class="control-label">Ссылка на резюме или файл</label>
                        <input type="text" id="vakancy-rezum" class="form-control" name="rezume_link" value="">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3 col-sm-4 col-xs-12">
                    <div class="form-group">
                      <div class="col-sm-12">
                        <label for="input-rezume0" class="control-label">&nbsp;</label>
                        <div class="input_file">
                          <div id="fountainG" class="loading">
                            <div id="fountainG_1" class="fountainG"></div>
                            <div id="fountainG_2" class="fountainG"></div>
                            <div id="fountainG_3" class="fountainG"></div>
                            <div id="fountainG_4" class="fountainG"></div>
                            <div id="fountainG_5" class="fountainG"></div>
                            <div id="fountainG_6" class="fountainG"></div>
                            <div id="fountainG_7" class="fountainG"></div>
                            <div id="fountainG_8" class="fountainG"></div>
                          </div>
                          <span>Выбрать</span>
                        </div>
                        <input type="hidden" name="rezume_code" value="" id="input-code" />
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-12">
                    <div class="form-group required">
                      <div class="col-sm-12">
                        <label for="" class="control-label">Расскажите о себе*</label>
                        <textarea name="text" id="vakancy-text" rows="6" class="form-control" row="4" type="text" value=""></textarea>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="rowmin">
                  <div class="col-sm-6 col-xs-12">
                    <div id="vakansy0" class="btn_gold" data-vakancy="0"><span>Отправить</span></div>
                  </div>
                  <div class="col-lg-5 col-sm-6 col-xs-12">
                    <p class="politics">Нажимая на кнопку, вы соглашаетесь с условиями <a href="{{politics}}" target="_blank">политики конфиденциальности и обработки персональных данных</a></p>
                  </div>
                </div>
              </div>
              <div class="form_success"><span>Спасибо, ваше резюме отправлено!</span></div>
            </form>
          </div>
        </div>
    </div>
  </div>
</div>
<script>
  $('.vakancy_block .btn_black').click(function(){
    $('.vakancy_name').text($(this).parent().children('.vakancy_title').text());
    $('#vakancy-form input[name="vak_name"]').val($(this).parent().children('.vakancy_title').text());
    $('#vakancy-form input[name="vakancy_id"]').val($(this).parent().data('vakancy'));
  });

  $('.form-vakancy .input_file').on('click', function() {
    var element = this;
    var self = $(this);

    $('#form-upload').remove();

    $('body').prepend('<form enctype="multipart/form-data" id="form-upload" style="display: none;"><input type="file" name="file" /></form>');

    $('#form-upload input[name="file"]').trigger('click');

    if (typeof timer != 'undefined') {
        clearInterval(timer);
    }

    timer = setInterval(function() {
      if ($('#form-upload input[name="file"]').val() != '') {
        clearInterval(timer);

        $.ajax({
          url: 'index.php?route=tool/upload',
          type: 'post',
          dataType: 'json',
          data: new FormData($('#form-upload')[0]),
          cache: false,
          contentType: false,
          processData: false,
          beforeSend: function() {
            $(element).children('.loading').addClass('on');
          },
          success: function(json) {
            if (json['error']) {
              alert(json['error']);
            }

            if (json['success']) {
              //alert(json['success']);

              $(element).children('.loading').removeClass('on');
              $(element).children('span').text(json['origin_name']);
              self.next().val(json['code']);
            }
          },
          error: function(xhr, ajaxOptions, thrownError) {
            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
          }
        });
      }
    }, 500);
  });

  $('.vakancy_more').click(function() {
    var vakancy = $(this).parent();
    var self_text = $(this).children('span');
    //var height = vakancy.outerHeight();

    if(!vakancy.hasClass('on')){
      self_text.text('Скрыть');
      vakancy.addClass('on');
    } else {
      vakancy.removeClass('on');
      self_text.text('Подробнее');
    }
  });

  $('.form-vakancy .btn_gold').click(function(){
    var self = $(this).parents('.form-horizontal');
    var form_data = {};
    var error_form = false;
    self.find('input, label').removeClass('_error');

    self.find('.form-group.required input, .form-group.required textarea').each(function(){
      if($(this).val() == ''){
        $(this).addClass('_error');
        $(this).prev().addClass('_error');
        error_form = true;
      }
    });

    if(!error_form){
      self.find('input, textarea').each(function(){
        form_data[$(this).attr('name')] = $(this).val();
      });

      form_data['uri'] = location.href;
      form_data['page'] = $('input[name="title_page"]').val();

      $.ajax({
        url: 'index.php?route=information/vakancy/form',
        type: 'post',
        data: form_data,
        dataType: 'json',
        complete: function() {
            //self.find('.btn_review').text('Отправляется');
        },
        success: function(json) {
          console.log(json);

          if(json.success){
            self.find('.form_block').animate({'opacity': 0}, 150);
            self.find('.form_success').fadeIn(150);

            setTimeout(function(){
              self.find('.form-group input, .form-group textarea').each(function(){
                $(this).val('');
              });

              self.find('.form_success').fadeOut(150);
              self.find('.form_block').animate({'opacity': 1}, 150);
            }, 3500);
          }
        }
      });
    }
  });
</script>
{{ footer }}
